---
// cspell:ignore hackernews dolk

import Layout from "./Layout.astro";
import RedditSVG from "../assets/blog/reddit.svg";
import LobstersSVG from "../assets/blog/lobsters.svg";
import HackernewsSVG from "../assets/blog/hackernews.svg";

interface Props {
  title: string;
  description?: string;
  minutesRead: string,
  pubDate?: Date;
  lobsters?: string;
  hackernews?: string;
  reddit?: string;
}

const { description = "Arhan's Blog", pubDate, minutesRead, title, lobsters, hackernews, reddit } = Astro.props;
---

<Layout {title} description={description} sshUser="blog" homeToBlog={true}>
  <script is:inline>
    let flexWrapper;
    document.addEventListener("DOMContentLoaded", () => {
      flexWrapper = document.querySelector("#flex-wrapper");
      if (!flexWrapper) {
        return;
      }
      const previousScrollPosition = sessionStorage.getItem("blog-scroll-position");
      if (!previousScrollPosition) {
        return;
      }
      flexWrapper.scrollTo(0, parseInt(previousScrollPosition, 10));
    });
    window.addEventListener("beforeunload", () => {
      if (flexWrapper) {
        sessionStorage.setItem("blog-scroll-position", flexWrapper.scrollTop.toString());
      }
    });
  </script>
  <div class="system-ui" id="max-width-wrapper">
    <h1>{title}</h1>
    <p id="top-row">
      <span id="left-top-row">
        {
          pubDate ?
          (
            <>
              Published
              <span data-date={pubDate?.valueOf()}>
                <script>
                  const parent = document.querySelector("[data-date]")!;
                  parent.textContent = new Date(+parent.getAttribute("data-date")!).toLocaleDateString("en-US", {
                    year: "numeric",
                    month: "long",
                    day: "numeric",
                  });
                </script>
              </span>
            </span>
          ) : "!! UNPUBLISHED !!"
        }
        &#x2022; {minutesRead}
        &#x2022; <a href="/blog/">more posts</a>
      </span>
      <span id="right-top-row">
        {
          (lobsters || hackernews || reddit) &&
          "View on"
        }
        {
          lobsters && <a href={lobsters}><LobstersSVG width={27} height={27} /></a>
        }
        {
          reddit && <a href={reddit}><RedditSVG width={27} height={27} /></a>
        }
        {
          hackernews && <a href={hackernews}><HackernewsSVG width={27} height={27} /></a>
        }
      </span>
    </p>
    <hr />
    <div class="offwhite" id="blog-body">
      <slot />
      {
        !import.meta.env.DEV &&
        <a id="scroll-to-top" href="#page-top">
          ↑ Scroll to top ↑
        </a>
      }
    </div>
    {
      pubDate && !import.meta.env.DEV && (
        <script
          is:inline
          src="https://giscus.app/client.js"
          data-repo="ArhanChaudhary/website"
          data-repo-id="R_kgDOLK1WSg"
          data-category="Blog"
          data-category-id="DIC_kwDOLK1WSs4CpZeI"
          data-mapping="title"
          data-strict="0"
          data-reactions-enabled="1"
          data-emit-metadata="0"
          data-input-position="top"
          data-theme="dark"
          data-lang="en"
          crossorigin="anonymous"
          async
        />
      )
    }
  </div>
</Layout>

<style lang="scss">
  #max-width-wrapper {
    margin-bottom: 10px;
    margin-right: auto;
    margin-left: auto;

    #blog-body {
      padding-bottom: 15px;

      #scroll-to-top {
        color: inherit;
        font-weight: bold;
        display: flex;
        justify-self: center;
      }
    }
  }
</style>

<style lang="scss" is:global>
  @use "../lib/variables";

  #nav-hamburger,
  nav {
    display: none !important;
  }

  #flex-wrapper {
    margin-right: initial !important;
    padding-right: initial !important;
  }

  main {
    margin-left: var(--mobile-outer-padding) !important;
  }

  svg {
    margin-block-start: 1.5em;
    margin-block-end: 1.5em;
    margin-right: auto;
    margin-left: auto;
    max-width: 100%;
    display: block;
  }

  #top-row {
    display: flex;
    flex-wrap: wrap;
  }

  #left-top-row {
    margin-right: 40px;
  }

  #right-top-row {
    display: flex;
    align-items: center;
    margin-bottom: 4px;
    margin-left: auto;

    svg {
      // pointer-events: none;
      display: inline-block;
      margin: 0;
      margin-left: 8px;
    }

    a {
      display: flex;
    }
  }

  sup {
    font-weight: bold;

    &::before {
      content: " ";
    }
  }

  table td {
    padding: 0.1em 1.25em;
  }
</style>
